@using FileBoy.Core.Extensions

<div class="file-list">
    <div class="list-header">
        <span class="col-name">Name</span>
        <span class="col-size">Size</span>
        <span class="col-properties">Properties</span>
        <span class="col-type">Type</span>
        <span class="col-date">Date</span>
    </div>
    
    <div class="list-body">
        @foreach (var item in Items)
        {
            <div class="list-row @(SelectedItem?.FullPath == item.FullPath ? "selected" : "")"
                 @onclick="() => SelectItem(item)"
                 @ondblclick="() => OpenItem(item)">
                <span class="col-name">
                    <span class="file-icon">@GetIcon(item)</span>
                    @item.Name
                </span>
                <span class="col-size">@(item.IsDirectory ? "" : item.Size.FormatFileSize())</span>
                <span class="col-properties">@GetProperties(item)</span>
                <span class="col-type">@GetTypeDescription(item)</span>
                <span class="col-date">@item.ModifiedDate.ToString("dd.MM.yyyy HH:mm")</span>
            </div>
        }
    </div>
</div>

@code {
    [Parameter]
    public IEnumerable<FileItem> Items { get; set; } = [];

    [Parameter]
    public FileItem? SelectedItem { get; set; }

    [Parameter]
    public EventCallback<FileItem> SelectedItemChanged { get; set; }

    [Parameter]
    public EventCallback<FileItem> OnItemDoubleClick { get; set; }

    private async Task SelectItem(FileItem item)
    {
        SelectedItem = item;
        await SelectedItemChanged.InvokeAsync(item);
    }

    private async Task OpenItem(FileItem item)
    {
        await OnItemDoubleClick.InvokeAsync(item);
    }

    private static string GetIcon(FileItem item) => item.ItemType switch
    {
        FileItemType.Directory => "ðŸ“",
        FileItemType.Image => "ðŸ–¼ï¸",
        FileItemType.Video => "ðŸŽ¬",
        _ => "ðŸ“„"
    };

    private static string GetProperties(FileItem item)
    {
        // For images/videos, this would show dimensions like "800x1280,16M"
        // This requires reading image metadata - placeholder for now
        if (item.ItemType == FileItemType.Image || item.ItemType == FileItemType.Video)
        {
            return ""; // TODO: Add image dimensions
        }
        return "";
    }

    private static string GetTypeDescription(FileItem item) => item.ItemType switch
    {
        FileItemType.Directory => "Directory",
        FileItemType.Image => GetImageType(item.Extension),
        FileItemType.Video => GetVideoType(item.Extension),
        _ => string.IsNullOrEmpty(item.Extension) ? "Unknown" : $"{item.Extension.TrimStart('.').ToUpper()} File"
    };

    private static string GetImageType(string extension) => extension.ToLowerInvariant() switch
    {
        ".png" => "Portable Network Graphics",
        ".jpg" or ".jpeg" => "JPEG TrueColor",
        ".gif" => "GIF Image",
        ".bmp" => "Bitmap Image",
        ".webp" => "WebP Image",
        ".ico" => "Icon",
        ".tiff" or ".tif" => "TIFF Image",
        _ => "Image"
    };

    private static string GetVideoType(string extension) => extension.ToLowerInvariant() switch
    {
        ".mp4" => "MP4 Video File",
        ".avi" => "AVI Video File",
        ".mkv" => "MKV Video File",
        ".mov" => "QuickTime Movie",
        ".wmv" => "Windows Media Video",
        ".webm" => "WebM Video",
        _ => "Video File"
    };
}
